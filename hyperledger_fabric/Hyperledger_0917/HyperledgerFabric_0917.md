

### 기존의 합의

- 중앙 집중형 방식에서의 합의는 서비스 제공자가 주체가 되어 사용자의 기록을 관리
- 장점 : 빠른 서비스 제공
- 단점 : 중앙기관이 앙의적인 의도로 기록 조작 가능, 악의적인 사용자는 중앙기관만 공격하면 기록 조작 가능

### 블록체인의 합의

- 중앙 집중형에서 장단점이 있지만, 블록체인이 나오기 전까지는 P2P에서 공개적인 합의는 불가능한 것이 정서
- 블록체인으로 구현된 합의 알고리즘이 P2P에서의 거래정보, 데이터 정보들을 동기화하고, 모든 주체들이 믿을 수 있도록 함
- 비트코인에서 블록을 합의하여 완전한 블록체인에 포함하기 위한 요소
  - 작업증명블록을 검증
  - 해당 거래에 대한 블록 검증 누적횟수

### 합의 알고리즘

- **합의 알고리즘**
  - P2P와 같이 정보도달에 시간차가 있는 네트워크에서 참여자가 결과 합의를 위한 알고리즘
  - P2P 두 가지 문제점 : 1) 정보의 지연, 2) 미도달 => 처리 중복 혹은 잘못된 정보 가능성
  - Ex) 비트코인 -PoW, Hyperledger Fabric - PBFT, Pos
- PoW의 문제점 - 문제를 빨리 푼 사람이 블록 생성(보상), 통신 두절 시 긴 블록체인(더 많은 승인)을 선택
  - 51% 문제 - 다수결 시스템의 문제 => 현재 중국 채굴자가 70% 정도 된다고 예상됨
  - 파이널리티 불확실성 - 짧은 체인의 노드 결과 변경 가능성 -> 6블럭 후 사용 가능
  - 성능 한계 - 합의에 걸리는 시간 -> 실시간 업무에 대한 적용 어려움
  - 블록체인 용량 - 모든 참가자가 모든 블록 소유 -> 장기적인 저장소 문제
- 분산 시스템의 장애 모델 -> P2P 네트워크의 사용가능한 장애 모델
  1. Fail Stop 모델 : 오류로 중지된 서버를 퇴출하는 모델
  2. Fail Recover 모델 : 정지한 서버가 부활 하는 모델
  3. Byzndtine Fault 모델 : 임의의 노드가 악의적 실수를 유발하는 모델
- **PoW(Proof of Work)**
  - 비트코인의 합의 알고리즘
  - 다수결의 결정으로 블록 확정
  - 참가자 수에 제한 없음
  - 네트워크 상태에 따라 Finality가 불확실
  - 많은 CPU 사용(전기 사용)
  - 성능 제한
- **PoS(Proof of Stake)**
  - Ethereum 채택 예정
  - 화폐 소유량에 따른 블록 생성 권한
  - 소유량이 많은 참가자는 가치를 지킨다
  - 해시 계산량이 대폭 줄어듬
  - 자원 소모량이 작음
- **PBFT(Practical Byzantine Fault Tolerance)**
  - Byzantine Fault 에 대한 대응 모델
  - Finality 불확실성 해결, 성능 향상
  - Hyperledger Fabric, Eris 등 컨소시엄형에서 사용
  - 모든 참가자를 미리 알아야 함
  - 1명이 Primary가 되어 요청을 보냄
  - 불량 노드 f개일 경우, 전체는 3f+1 이상
  - 확정에는 f+1개의 동의 필요
  - 필요수 이하인 경우, 시스템 정지
  - 블록의 분기가 없음
  - 리더가 부정일 경우, 다수결로 리더 교체
  - 단점 : 참가자 수에 따른 통신량 증가
- **Sieve(체, 조리..?)**
  - IBM에서 고안한 PBFT 확장 알고리즘
  - 2016년 7월부로 Hyperledger Fabric에서 제외
  - 합의 형성 전에 결과 검토 추가
- **Paxos**
  - 가장 유명한 합의 알고리즘 중 하나
  - 합의 형성에 특화
  - 과반수 동의 시, Finality 완성
  - Byzantine Fault 대응이 되지 않음
  - 악의를 가진 참여자 환경에서는 부적절
  - 실제 구현에 어려움
- **Raft(뗏목?)**
  - Paxos에 비해 상세하고 간결 => 쉬운구현
  - 리더 선출 구조
  - 리더의 수행 지시에 의해 follower가 저장
  - 분할된 네트워크에서 각자 리더 선정
  - 과반수가 넘지 못하는 네트워크는 commit 안됨
- **PoI(Proof of Importance)**
  - 구글 검색 알고리즘이었던 Page Rank 알고리즘을 응용하여 개발됨
  - PoS와 유사하지만 계정의 잔액 규모에만 의존하지 않는다는 점이 다름
  - 빈익빈 부익부 현상을 막고자 계정의 잔액 규모가 아니라 많은 양의 코인을 빈번하게 거래할수록 가치가 높아짐
- **Consensus-by-bet**
  - 기존의 알고리즘과는 달리, 참여자의 동의 및 배팅을 통해서 블록체인의 거래를 승인하는 방식
  - 동의를 통한 승인구조는 어느 한 사람이나 단체가 네트워크를 독점하기 어려움



## 실습

### Fabric Samples 예제 파일 설치

💲`crul -sSL http://bit.ly/2ysbOFE | bash -s 1.3.0 1.3.0 0.4.13`  명령어 실행

💲`cd fabric-samples/first-network`

~/fabric-samples/first-network💲`./byfn.sh generate -c mychannel` 이라고 명령어 입력한 후 실행해서 실행되는지 확인

~/fabric-samples/first-network/channel-artifacts💲`ls -al` 명령어로 4개의 파일 생성 확인

~/fabric-samples/first-network/💲`./byfn.sh up` 실행해서 docker 를 띄운다.

안될경우,

💲`./byfn.sh down` 하고 첫번째 image 지우고 다시 up



